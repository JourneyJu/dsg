// Code generated by gorm.io/gen. DO NOT EDIT.
// Code generated by gorm.io/gen. DO NOT EDIT.
// Code generated by gorm.io/gen. DO NOT EDIT.

package model

import (
	"database/sql"
	"time"

	"github.com/kweaver-ai/idrm-go-frame/core/utils"
	"github.com/kweaver-ai/dsg/services/apps/configuration-center/common/errorcode"
	"github.com/kweaver-ai/dsg/services/apps/configuration-center/common/util"
	"github.com/kweaver-ai/idrm-go-frame/core/telemetry/log"
	"gorm.io/gorm"
	"gorm.io/plugin/soft_delete"
)

const TableNameAuditPolicy = "audit_policy"

// AuditPolicy mapped from table <audit_policy>
type AuditPolicy struct {
	Sid            uint64                `gorm:"column:sid;not null" json:"sid"`                                            // 雪花id
	ID             string                `gorm:"column:id;primaryKey" json:"id"`                                            // 对象id，uuid
	Name           string                `gorm:"column:name;not null" json:"name"`                                          // 名称
	Description    sql.NullString        `gorm:"column:description;not null" json:"description"`                            // 描述
	Type           string                `gorm:"column:type;not null" json:"type"`                                          // 类型：customize(自定义的), built-in(内置的)）
	Status         string                `gorm:"column:status;not null" json:"status"`                                      // 策略状态，1：未启用，2：已启用
	ResourcesCount sql.NullInt64                 `gorm:"column:resources_count" json:"resources_count"`                             // 资源数量
	AuditType      sql.NullString        `gorm:"column:audit_type;not null" json:"audit_type"`                              // 审核类型 af-data-view-publish 发布审核 af-data-view-online 上线审核  af-data-view-offline 上线审核
	ProcDefKey     sql.NullString        `gorm:"column:proc_def_key;not null" json:"proc_def_key"`                          // 审核流程key
	ServiceType    sql.NullString        `gorm:"column:service_type" json:"service_type"`                                   // 所属业务模块，如逻辑视图业务为data-view
	CreatedAt      time.Time             `gorm:"column:created_at;not null;default:current_timestamp(3)" json:"created_at"` // 创建时间
	CreatedByUID   string                `gorm:"column:created_by_uid;not null" json:"created_by_uid"`                      // 创建用户ID
	UpdatedAt      time.Time             `gorm:"column:updated_at;not null;autoUpdateTime" json:"updated_at"` // 更新时间
	UpdatedByUID   string                `gorm:"column:updated_by_uid;not null" json:"updated_by_uid"`                      // 更新用户ID
	DeletedAt      soft_delete.DeletedAt `gorm:"column:deleted_at;not null;softDelete:milli" json:"deleted_at"`             // 删除时间(逻辑删除)
}

func (m *AuditPolicy) BeforeCreate(_ *gorm.DB) error {
	if m == nil {
		return nil
	}

	if m.Sid == 0 {
		a, err := utils.GetUniqueID()
		if err != nil {
			log.Errorf("failed to general unique id, err: %v", err)
			err = errorcode.Desc(errorcode.PublicUniqueIDError)
			return err
		}
		m.Sid = a
	}

	if len(m.ID) == 0 {
		m.ID = util.NewUUID()
	}

	return nil
}

// TableName AuditPolicy's table name
func (*AuditPolicy) TableName() string {
	return TableNameAuditPolicy
}
